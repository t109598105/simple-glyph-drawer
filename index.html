<!DOCTYPE html><html><head><meta charset=utf-8><title>Text Drawer</title><style>@import url(https://fonts.googleapis.com/css2?family=Open+Sans:wght@300&display=swap);*{margin:0;padding:0;font-family:'Open Sans',sans-serif;box-sizing:border-box}#root{height:100vh;width:100vw;display:flex;justify-content:center;align-items:center;padding:1rem;position:relative;background-color:#6b4c9c38}#root #container,#root #svg-text{width:90vh;height:90vh;margin:1rem 5rem;border-style:solid;border-width:1px}#root #svg-text textarea{resize:none;height:100%;width:100%;font-size:10px}#root #container{position:relative}#root #container #drag-tip{position:absolute;top:0;bottom:0;right:0;left:0;height:100%;width:100%;background-color:rgba(10,10,10,.253);display:none}#root #container #drag-tip.dragged{display:table}#root #container #drag-tip div{font-size:100px;vertical-align:middle;text-align:center;display:table-cell}#root .side-bar{height:100%;right:0;position:absolute;width:5vw;border-left-style:solid;border-width:1px}#root .side-bar .side-group{padding:10px 5px}#root .side-bar .side-bottom{border-top-style:solid;position:absolute;bottom:0}#root .side-bar div.side-item{text-align:center;margin-bottom:20px;border-radius:50%;border-style:solid;overflow:hidden;cursor:pointer;position:relative}#root .side-bar div.side-item.banned::after{background-image:url(banned.svg);background-position:center;width:100%;height:100%;top:0;left:0;position:absolute;z-index:99;content:""}#root .side-bar img{width:100%}#root .side-bar div.side-item.banned img{opacity:.5}svg{cursor:url(pen.svg),auto}</style></head><body><div id=root><div id=container><div id=drag-tip><div>Drag your picture here</div></div></div><div id=svg-text><textarea id=svg-text-area readonly=readonly>  </textarea></div><div class=side-bar><div class=side-group><div class="side-item banned" id=autodraw-switch title="toggle autodraw"><img src=./draw.svg></div><div class=side-item id=bg-switch title="toggle font background"><img src=./background.svg></div><div class=side-item id=clear-btn title="clear pixels"><img src=./clear.svg></div></div><div class="side-group side-bottom"><div class=side-item id=export-svg title="export as svg"><img src=./svg.svg></div><div class=side-item id=export-data title="export as binary save data"><img src=./file.svg></div></div></div></div><script src=https://d3js.org/d3.v3.min.js></script><script src=./PixelDealer.js></script><script>d3.select(window).on("load",function(){function f(t,e){function n(){l.selectAll("image").remove(),l.append("image").attr("href",r.result).attr("width","100%").attr("height","100%").attr("x",0).attr("y",0),"function"==typeof e&&e(),s()}var r=new FileReader;r.onload=function(){var t;i?(t=new PixelDealer(r.result,c)).load(function(){t.draw(),p=t.rectData,x(),n()}):n()},r.readAsDataURL(t)}var l,r=d3.select("#container"),t=d3.select("#svg-text-area"),o=r.node().getBoundingClientRect().width,n=20,c=46,a=null,i=!1,u=!0,h=400,e=n*c,p=new Array(c*c).fill(0),d=r.append("svg").attr("width","100%").attr("height","100%").attr("viewBox","0 0 "+e+" "+e).attr("xmlns","http://www.w3.org/2000/svg"),s=function(){t.html(""),t.html(r.html().replace(/\<div(.*)?\<\/div>\<\/div\>/,"").replace(/href\=\"data\:image\/(.*)?\"/,'href="data:image...."').trim())},g=!1,v=!1,w=null,m=1,y=[1,9,25,49],b={target:null,getPen:function(t,e){this.target=new Array(m).fill([t-y.indexOf(m),e-y.indexOf(m)]).map(function(t,e){return[t[0]+e%Math.sqrt(m),t[1]+Math.floor(e/Math.sqrt(m))]}).filter(function(t){return void 0===t.find(function(t){return c<=t||t<0})}).map(function(t){return t[1]*c+t[0]})}},x=function(){d.selectAll("*").remove();var i=d.selectAll("rect").data(p).enter().append("rect").attr("transform",function(t,e){return"translate("+e%c*n+","+Math.floor(e/c)*n+")"}).attr("stroke","black").attr("stroke-width",".1px").attr("fill",function(t){return t?"black":"white"}).attr("width",n).attr("height",n).on("contextmenu",function(t,e){d3.event.preventDefault()}).on("mousedown",function(t,e){var n=e%c,e=Math.floor(e/c),r=(b.getPen(n,e),[]),n=i.filter(function(t,e){if(-1!=b.target.indexOf(e))return r.push(e),!0});0==d3.event.button?(g=!0,n.attr("fill","black"),r.forEach(function(t){p[t]=1}),s()):2==d3.event.button&&(v=!0,n.attr("fill","white"),r.forEach(function(t){p[t]=0}),s()),null!==w&&n.each(function(){w.push({target:this,fill:d3.select(this).attr("fill")})})}).on("mousewheel",function(t,e){d3.event.preventDefault();var n=e%c,e=Math.floor(e/c),r=this,a=y.indexOf(m),a=(0<d3.event.deltaY?a-1<0?a=0:a--:d3.event.deltaY<0&&(a+1>=y.length?a=y.length-1:a++),m=y[a],b.getPen(n,e),i.filter(function(t,e){return-1!=b.target.indexOf(e)}));null!==w&&(w.forEach(function(t){d3.select(t.target).attr("fill",t.fill)}),a.each(function(){this!=r&&w.push({target:this,fill:d3.select(this).attr("fill")})})),a.attr("fill","#00000035")}).on("mousemove",function(t,e){var n=e%c,e=Math.floor(e/c),r=(b.getPen(n,e),[]),n=i.filter(function(t,e){if(-1!=b.target.indexOf(e))return r.push(e),!0});g?(n.attr("fill","black"),r.forEach(function(t){p[t]=1}),s()):v&&(n.attr("fill","white"),r.forEach(function(t){p[t]=0}),s()),null===w&&(w=[],n.each(function(){w.push({target:this,fill:d3.select(this).attr("fill")})})),n.attr("fill","#00000035")}).on("mouseleave",function(t,e){w.forEach(function(t){d3.select(t.target).attr("fill",t.fill)}),w=null}).on("mouseup",function(t,e){0==d3.event.button?g=!1:2==d3.event.button&&(v=!1)});l=d.append("g").attr("style","opacity: 0.3;pointer-events: none;").attr("display",u?"":"none")};x();r.on("dragenter",function(){d3.event.preventDefault(),d3.select("#drag-tip").classed("dragged",!0)}).on("dragover",function(){d3.event.preventDefault()}).on("drop",function(){d3.event.preventDefault(),d3.select("#drag-tip").classed("dragged",!1);var t,s,e=d3.event.dataTransfer.files[0];return"dat"==e.name.split(".").slice(-1)[0]?(t=e,(s=new FileReader).onload=function(){var t=new TextDecoder("utf-8"),e=new Uint8Array(s.result),n=e.slice(0,h),t=t.decode(n).split("\n");if("**TextDrawer Export File**"!=t.shift())return console.error("Not a valid stored data");var n=parseInt(t[0].split(":")[1].trim()),r=parseInt(t[1].split(":")[1].trim()),a=parseInt(t[2].split(":")[1].trim()),i=parseFloat(t[3].split(":")[1].trim()),l=parseInt(t[4].split(":")[1].trim()),o=parseInt(t[5].split(":")[1].trim()),c=t[6].split(":")[1].trim(),t=t[7].split(":")[1].trim(),d=new Date,n=(d.setTime(n),console.log("LastModify: "+d.toString()),console.log("Rect Size: "+a),console.log("Container Size: "+i),Array.from(e.slice(h,h+l))),d=e.slice(h+l);m=r,p=n,u="none"!=t,d3.select("#bg-switch").classed("banned",!u),x(),0!=o&&f(new Blob([d.buffer],{type:c}))},void s.readAsArrayBuffer(t)):e.type.startsWith("image/")?void f(a=e):console.error("Not a valid image type")}),d3.select("#export-svg").on("click",function(){var t=d3.select(r.node().cloneNode(!0)),e=(t.selectAll("div").remove(),t.html().trim()),n=t.append("a").attr("href",URL.createObjectURL(new Blob([e],{type:"image/svg+xml"}))).attr("download","export.svg");n.node().click(),window.setTimeout(function(){URL.revokeObjectURL(n.attr("href"))},50)}),d3.select("#export-data").on("click",function(){function t(t,e){var n=new TextEncoder("utf-8"),r=["**TextDrawer Export File**","LastModified: "+(new Date).getTime(),"PenSize: "+m,"RectSize: 20","ContainerSize: "+o,"DataSize: "+t.length,"BackgroundPicSize: "+e.arr.length,"BackgroundPicType: "+e.type,"BackgroundPicDisplay: "+l.attr("display"),""].join("\n"),a=new Uint8Array(h);a.set(n.encode(r),0);(n=new Uint8Array(h+t.length+e.arr.length)).set(a,0),n.set(t,h),n.set(e.arr,h+t.length);var i=document.createElement("a");d3.select(i).attr("href",URL.createObjectURL(new Blob([n.buffer]))).attr("download","data.dat"),i.click(),window.setTimeout(function(){URL.revokeObjectURL(i.href)},50)}var e,n=Uint8Array.from(p);null!==a?(a.type,(e=new FileReader).onload=function(){t(n,{type:a.type,arr:new Uint8Array(e.result)})},e.readAsArrayBuffer(a)):t(n,{type:"",arr:new Uint8Array([])})}),s(),d3.select("#autodraw-switch").on("click",function(){i=!i,d3.select(this).classed("banned",!i)}),d3.select("#bg-switch").on("click",function(){u=!u,d3.select(this).classed("banned",!u),u?l.attr("display",""):l.attr("display","none"),s()}),d3.select("#clear-btn").on("click",function(){d.selectAll("rect").attr("fill","white"),p.fill(0)})})</script></body></html>